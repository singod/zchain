/**
 *
 * ZChain JS
 * Version:  0.1
 * weibo: @snandy
 * Blog: http://snandy.cnblogs.com
 * Date: 2011-09-19
 * 
 * 1, 重写了选择器，已支持id，className, tagName, attribute
 * 2, 重写了事件模块
 * 3, 去掉了isUndefined，isNull，isBoolean，isString，isNumber等
 * 4, 事件模块重写  （die/undelegate）
 * 5, 增加domReady（$.ready 或  $(function(){})）
 * 6, 增加data/removeData，事件模块重写利用data函数
 * 7, 增加特性判断模块（support对象）
 * 8, class属性操作重写（标准浏览器使用classList属性）
 *
 */
(function(e,t){function m(e){return E.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}function g(e,t,n,r){try{r=e.getBoundingClientRect()}catch(i){}if(!r||!E.contains(n,e))return r?{top:r.top,left:r.left}:{top:0,left:0};var s=t.body,o=m(t),u=n.clientTop||s.clientTop||0,a=n.clientLeft||s.clientLeft||0,f=o.pageYOffset||n.scrollTop||s.scrollTop,l=o.pageXOffset||n.scrollLeft||s.scrollLeft,c=r.top+f-u,h=r.left+l-a;return{top:c,left:h}}function y(e,t){var n=E(e),r=n.css("position");r==="static"&&(e.style.position="relative");var i="top",s="left",o=n.offset(),u=n.css("top"),a=n.css("left"),f=(r==="absolute"||r==="fixed")&&[u,a].join(",").indexOf("auto")>-1,l={},c={},h,p;f?(c=n.pos(),h=c.top,p=c.left):(h=parseFloat(u)||0,p=parseFloat(a)||0),t.top!=null&&(l.top=t.top-o.top+h),t.left!=null&&(l.left=t.left-o.left+p),n.css(l)}function b(e,t,n){function i(e){var i=t=="className"?e.className:e.getAttribute(t);if(i){if(!n)return!0;if(r.test(i))return!0}return!1}var r=RegExp("(?:^|\\s+)"+n+"(?:\\s+|$)"),s=-1,o,u=-1,a=[];while(o=e[++s])i(o)&&(a[++u]=o);return a}function w(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})}function E(e,t){return new E.prototype.init(e,t)}var n=Object.prototype,r=String.prototype,i=Array.prototype,s=i.slice,o=i.push,u=e.document,a=u.compatMode=="CSS1Compat",f=/\s/,l=/^\s+/,c=/\s+$/,h=/^(?:body|html)$/i;f.test("\u00a0")||(l=/^[\s\xA0]+/,c=/[\s\xA0]+$/);var p=function(e){return s.call(e,0)};try{s.call(u.documentElement.childNodes,0)[0].nodeType}catch(d){p=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t[n]=e[n];return t}}var v=function(){var e,t,n;e=u.createElement("div"),e.className="a",e.innerHTML='<p style="color:red;"><a href="#" style="opacity:.45;float:left;">a</a></p>',e.setAttribute("class","t"),t=e.getElementsByTagName("p")[0],n=t.getElementsByTagName("a")[0];var r,r,i,s;return r=e.className==="t",cssText=/;/.test(t.style.cssText),i=/^0.45$/.test(n.style.opacity),s=!!u.defaultView&&!!u.defaultView.getComputedStyle,{setAttr:r,cssText:cssText,opacity:i,classList:!!e.classList,cssFloat:!!n.style.cssFloat,getComputedStyle:s}}();E.prototype={init:function(n,r){var i=/^#[-\w]+/,s=/^([-\w]+)?\.([-\w]+)/,o=/^([\w\*]+)$/,a=/^([\w]+)?\[([\w]+-?[\w]+?)(=(\w+))?\]/,f=/^[-#\w]+$/.test(n);r=r===t?u:typeof r=="string"?u.getElementById(r.substr(1,r.length)):r;if(n==null)return;if(typeof n=="function"){E.ready(n);return}if(n.nodeType||n==e){this[0]=n,this.length=1;return}if(i.test(n)){this[0]=u.getElementById(n.substr(1,n.length)),this[0]&&(this.length=1);return}if(!f&&r.querySelectorAll){if(r.nodeType==1){var l=r.id,c=r.id="__zchain__";try{return this._toSelf(r.querySelectorAll("#"+c+" "+n))}catch(h){}finally{l?r.id=l:r.removeAttribute("id")}}this._toSelf(r.querySelectorAll(n));return}if(s.test(n)){var p=n.split("."),d=r.getElementsByTagName(p[0]||"*");this._toSelf(b(d,"className",p[1]));return}if(o.test(n)){this._toSelf(r.getElementsByTagName(n));return}if(a.test(n)){var p=a.exec(n),d=r.getElementsByTagName(p[1]||"*");this._toSelf(b(d,p[2],p[4]));return}},length:0,_toSelf:function(e){o.apply(this,p(e))},find:function(e,n){var r=n===t?this[0]:this[n];return new E.prototype.init(e,r)},toArray:function(){return p(this)},slice:function(){var e=E(),t=s.apply(this,arguments);return o.apply(e,t),e},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},get:function(e){return e==null?this.toArray():e<0?this.slice(e)[0]:this[e]},each:function(e){return E.each(this,e),this},attr:function(e,n){if(n!==t)return this.each(function(t){switch(e){case"class":t.className=n;break;case"style":t.style.cssText=n;break;default:t.setAttribute(e,n)}}),this;var r=this[0];switch(e){case"class":return r.className;case"style":return r.style.cssText;default:return r.getAttribute(e)}},prop:function(e,n){return n===t?this[0][e]:(this.each(function(t){t[e]=n}),this)},css:function(n,r){if(typeof n=="object"){for(var i in n)this.css(i,n[i]);return}if(r===t){var s=this[0],o;if(n=="opacity"){var a,f,l=/opacity=/i;return E.ie?(o=s.currentStyle,f=o.filter,l.test(f)?parseFloat(f.match(/opacity=([^)]*)/i)[1])/100:1):(o=e.getComputedStyle(s,null),a=o.opacity,a.length>1&&(a=a.substr(0,3)),parseFloat(a))}if(e.getComputedStyle)return e.getComputedStyle(s,null).getPropertyValue(w(n));if(u.defaultView&&u.defaultView.getComputedStyle){var c=u.defaultView.getComputedStyle(s,null);if(c)return c.getPropertyValue(w(n))}return s.currentStyle?s.currentStyle[n]:s.style[n]}return this.each(function(e){n=="opacity"?E.ie?(e.style.filter="alpha(opacity="+r*100+");",e.style.zoom=1):e.style.opacity=r==1?"":""+r:(typeof r=="number"&&(r+="px"),e.style[n]=r)}),this},offsetParent:function(){var e=this[0].offsetParent||document.body;while(e&&!h.test(e.nodeName)&&E(e).css("position")==="static")e=e.offsetParent;return E(e)},pos:function(){if(!this[0])return null;var e=this.offsetParent(),t=this.offset(),n=h.test(e[0].nodeName)?{top:0,left:0}:e.offset();return t.top-=parseFloat(this.css("marginTop"))||0,t.left-=parseFloat(this.css("marginLeft"))||0,n.top+=parseFloat(e.css("borderTopWidth"))||0,n.left+=parseFloat(e.css("borderLeftWidth"))||0,{top:t.top-n.top,left:t.left-n.left}},offset:function(e){if(arguments.length)return e===t?this:this.each(function(t){y(this,e,t)});var n=this[0],r=n&&n.ownerDocument;return r?g(n,r,r.documentElement):null},isStyle:function(e,t){return this.css(e)==t},text:function(e){return this.prop(this[0].innerText===t?"innerText":"textContent",e)},html:function(e){return this.prop("innerHTML",e)},val:function(e){if(e===t){var n=this[0];return n.tagName=="INPUT"&&/checkbox|radio/.test(n.type)?n.checked:n.value}return this.prop("value",e)},hasClass:function(e){return S.has(this[0],e)},addClass:function(e){return this.each(function(t){S.add(t,e)})},removeClass:function(e){return this.each(function(t){S.remove(t,e)})},toggleClass:function(e){return this.each(function(t){S.toggle(t,e)})},replaceClass:function(e,t){return this.each(function(n){S.replace(n,e,t)})},on:function(e,t,n,r){return this.each(function(i){E.event.add({el:i,type:e,fn:t,once:n,live:r})})},un:function(e,t){return this.each(function(n){E.event.remove({el:n,type:e,fn:t})})},fire:function(e){this.each(function(t){E.event.dispatch(t,e)})},delegate:function(e,t,n){return arguments.length===2&&E.isFunction(t)&&(n=t,t="click"),this.each(function(r){E(r).on(t,function(t){var r=t.target;E(e,this).each(function(e){(r==e||E.contains(e,r))&&n.call(e,t)})},null,n)})},undelegate:function(e,t,n){return this.each(function(e){E(e).un(t,n)})},hover:function(e,t){this.each(function(n){E(n).mouseenter(e).mouseleave(t)})}},E.fn=E.prototype.init.prototype=E.prototype,E.extend=E.fn.extend=function(e){for(var t in e)this[t]=e[t]};var S=function(){function o(e,t){return e.nodeType!==1||typeof t!="string"?!1:!0}var e=v.classList,t,n,r,i,s;return e?(t=function(e,t){return o(e,t)?e.classList.contains(t):!1},n=function(e,t){var n=0,r;if(o(e,t)){t=t.split(" ");while(r=t[n++])e.classList.add(r)}},r=function(e,t){var n=0,r;if(o(e,t)){t=t.split(" ");while(r=t[n++])e.classList.remove(r)}},i=function(e,t){o(e,t)&&e.classList.toggle(t)}):(t=function(e,t){return o(e,t)?(" "+e.className+" ").indexOf(" "+t+" ")!=-1:!1},n=function(e,n){o(e,n)&&!t(e,n)&&(e.className+=(e.className?" ":"")+n)},r=function(e,t){o(e,t)&&(e.className=e.className.replace(RegExp("\\b"+t+"\\b","g"),""))},i=function(e,i){t(e,i)?r(e,i):n(e,i)}),s=function(e,t,i){r(e,t),n(e,i)},{has:t,add:n,remove:r,toggle:i,replace:s}}();E.extend({uuid:0,cache:{},expando:"zChain"+(""+Math.random()).replace(/\D/g,""),data:function(e,n,r){var i=E.expando,s=typeof n=="string",o,u=e.nodeType,a=u?E.cache:e,f=u?e[i]:e[i]&&i;return!f&&u&&(e[i]=f=++E.uuid),a[f]||(a[f]={}),o=a[f],r!==t&&(o[n]=r),s?o[n]:o},removeData:function(e,t){var n=E.expando,r=e[n],i=E.cache[r];if(!r||!i)return;typeof t=="string"?delete i[t]:delete E.cache[r]}}),E.fn.extend({data:function(e,n){if(e===t)return E.data(this[0]);if(n===t)return E.data(this[0],e);this.each(function(){E.data(this,e,n)})},removeData:function(e){return this.each(function(){E.removeData(this,e)})}}),E.extend({isFunction:function(e){return typeof e=="function"},isPlainObject:function(t){return!t||t===e||t===u||t===u.body?!1:"isPrototypeOf"in t&&n.toString.call(t)==="[object Object]"},isEmptyObject:function(e){for(var t in e)return!1;return!0},isPrimitive:function(e){var n=typeof e;return e===t||e===null||n=="boolean"||n=="number"||n=="string"},isWindow:function(e){return e!=null&&e==e.window},ready:function(t){function f(e){r(e),s?e():i.push(e)}function r(){if(o)return;o=1,u.readyState==="complete"?n():u.addEventListener?(u.addEventListener("DOMContentLoaded",function(){u.removeEventListener("DOMContentLoaded",arguments.callee,!1),n()},!1),e.addEventListener("onload",n,!1)):u.attachEvent&&(u.attachEvent("onreadystatechange",function(){u.readyState==="complete"&&(u.detachEvent("onreadystatechange",arguments.callee),n())}),e.attachEvent("onload",n),a.doScroll&&e==e.top&&l())}function n(){s=1;if(!u.body){setTimeout(n,10);return}for(var e=0,t=i.length;e<t;e++)i[e]();i=[]}function l(){if(s)return;try{a.doScroll("left")}catch(e){setTimeout(l,10);return}n()}var n,r,i=[],s=0,o=0,a=u.createElement("p");return f}()}),E.extend(function(e){var t={msie:/msie/.test(e)&&!/opera/.test(e),opera:/opera/.test(e),safari:/webkit/.test(e)&&!/chrome/.test(e),firefox:/firefox/.test(e),chrome:/chrome/.test(e),maxthon:/maxthon/.test(e),sogou:/se/.test(e),tt:/TencentTraveler/.test(e)},n="",r;for(var i in t)if(t[i]){n="safari"==i?"version":i;break}return t.version=n&&RegExp("(?:"+n+")[\\/: ]([\\d.]+)").test(e)?RegExp.$1:"0",t.ie=t.msie,r=parseInt(t.version,10),t.ie6=t.msie&&r==6,t.ie7=t.msie&&r==7,t.ie8=t.msie&&r==8,t.ie9=t.msie&&r==9,t}(navigator.userAgent.toLowerCase())),E.extend({each:function(e,t){var n,r=0,i=e.length;if("length"in e)for(var s=e[0];r<i&&t.call(s,s,r)!==!1;s=e[++r]);else for(n in e)if(t.call(e[n],e[n],n)===!1)break},map:function(e,n){var r,i,s=[],o=0,u=e.length,a=u!==t&&typeof u=="number";if(a)for(;o<u;o++)r=n(e[o],o),r!=null&&(s[s.length]=r);else for(i in e)r=n(e[i],i),r!=null&&(s[s.length]=r);return s.concat.apply([],s)},makeArray:p,applyIf:function(e,n){var r=s.call(arguments,1),i=-1,o;if(r.length)while(n=r[++i])for(o in n)e[o]===t&&(e[o]=n[o]);return e},contains:function(e,t){try{return e.contains?e!=t&&e.contains(t):!!(e.compareDocumentPosition(t)&16)}catch(n){}}}),E.extend({array:{contain:function(e,t){return e.indexOf(t)!=-1},removeAt:function(e,t){return i.splice.call(e,t,1).length==1},remove:function(e,t){var n=e.indexOf(t),r;return(r=n>=0)&&this.removeAt(e,n),r}},string:{encodeUriRegExp_:/^[a-zA-Z0-9\-_.!~*'()]*$/,startsWith:function(e,t){return e.lastIndexOf(t,0)==0},endsWith:function(e,t){var n=e.length-t.length;return n>=0&&e.indexOf(t,n)==n},isEmpty:function(e){return/^[\s\xa0]*$/.test(e)},isNumeric:function(e){return!/[^0-9]/.test(e)},toNumber:function(e){var t=Number(e);return t==0&&this.isEmpty(e)?NaN:t},trimLeft:function(e){return e.replace(l,"")},trimRight:function(e){return e.replace(c,"")},left:function(e,t){var n=e.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");return n=n.slice(0,t).replace(/\*\*/g," ").replace(/\*/g,"").length,e.slice(0,n)},right:function(e,t){var n=e.length,r=e.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");return r=r.slice(r.length-t,r.length).replace(/\*\*/g," ").replace(/\*/g,"").length,e.slice(n-r,n)},urlEncode:function(e){return e=String(e),this.encodeUriRegExp_.test(e)?e:encodeURIComponent(e)},urlDecode:function(e){return decodeURIComponent(e.replace(/\+/g," "))}},cookie:function(e,t){if(arguments.length!=2){var r=e+"=",i=u.cookie,s=i.length;if(i.indexOf(r)!=-1){var o=i.indexOf(r)+r.length;return i.indexOf(";",o)==-1?s=i.length:s=i.indexOf(";",o),i.substring(o,s)}return""}var n=new Date(2099,12,31);u.cookie=e+"="+t+";expires="+n.toGMTString()+";"}});var x=function(){function n(e,t){function n(){}t=t||{};var s=t.async!==!1,o=t.method||"GET",u=t.type||"text",a=t.encode||"UTF-8",f=t.timeout||0,l=t.data||null,c=t.success||n,h=t.failure||n;o=o.toUpperCase(),l&&typeof l=="object"&&(l=r(l)),o=="GET"&&l&&(e+=(e.indexOf("?")==-1?"?":"&")+l,l=null);var p=function(){try{return new XMLHttpRequest}catch(e){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){h(null,"create xhr failed",e)}}}}();if(!p)return;var d=!1,v;return s&&f>0&&(v=setTimeout(function(){d=!0,p.abort()},f)),p.onreadystatechange=function(){p.readyState==4&&(d?h(p,"request timeout"):(i(p,u,c,h),clearTimeout(v)))},p.open(o,e,s),o=="POST"&&p.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset="+a),p.send(l),p}function r(e){var t=[];for(var n in e){var r=e[n];if(r.constructor==Array)for(var i=0,s=r.length;i<s;i++)t.push(n+"="+encodeURIComponent(r[i]));else t.push(n+"="+encodeURIComponent(r))}return t.join("&")}function i(n,r,i,s){var o=n.status,u;if(o>=200&&o<300){switch(r){case"text":u=n.responseText;break;case"json":u=function(t){try{return e.JSON.parse(t)}catch(r){try{return(new Function("return "+t))()}catch(r){s(n,"parse json error",r)}}}(n.responseText);break;case"xml":u=n.responseXML}u!==t&&i(u)}else s(n,n.status);n=null}return function(){var e={request:n},t=["text","json","xml"];return E.each(t,function(t,r){e[t]=function(e,r){return r=r||{},r.type=t,n(e,r)}}),e}()}(),T=function(){function o(e){var e=e;return E.ie||(e=e=="mouseenter"?"mouseover":e=="mouseleave"?"mouseout":e),e}function a(e,t){for(var n=0;n<e.length;)t(n,e[n])?n=0:n++}function f(){return(new Date).getTime()}function l(){return!1}function c(){return!0}function h(e){this.originalEvent=e,this.type=e.type,this.timeStamp=f()}function p(e){var n="altKey bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedTarget screenX screenY shiftKey target toElement view wheelDelta which".split(" "),r=n.length,i=e;e=new h(i);for(var s=r,o;s;)o=n[--s],e[o]=i[o];e.target||(e.target=e.srcElement||document),e.target.nodeType===3&&(e.target=e.target.parentNode),!e.relatedTarget&&e.fromElement&&(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement);if(e.pageX==null&&e.clientX!=null){var u=document.documentElement,a=document.body;e.pageX=e.clientX+(u&&u.scrollLeft||a&&a.scrollLeft||0)-(u&&u.clientLeft||a&&a.clientLeft||0),e.pageY=e.clientY+(u&&u.scrollTop||a&&a.scrollTop||0)-(u&&u.clientTop||a&&a.clientTop||0)}return!e.which&&(e.charCode||e.charCode===0?e.charCode:e.keyCode)&&(e.which=e.charCode||e.keyCode),!e.metaKey&&e.ctrlKey&&(e.metaKey=e.ctrlKey),!e.which&&e.button!==t&&(e.which=e.button&1?1:e.button&2?3:e.button&4?2:0),e}function d(e,t){var t=o(t),n=E.data(e,"events");i(e,t,n[t].handle),delete n[t],E.isEmptyObject(n)&&E.removeData(e,"events")}function v(t){function h(t){var r=p(t||e.event),i=E.data(this,"events")[r.type];for(var s=0,o;o=i[s++];)typeof o=="function"?!!E.ie||a!="mouseenter"&&a!="mouseleave"?o.call(n,r):d(r):o.one?(o.one.call(n,r),m({el:n,type:a,fn:o.one}),s--):o.live&&o.handler.call(n,r)}function d(e){!E.contains(e.currentTarget,e.relatedTarget)&&e.currentTarget!=e.relatedTarget&&i.call(e.currentTarget,e)}var n=t.el,i=t.fn,s=t.once,u=t.live,a=t.type||"click",f,l;if(n==e||n.nodeType===3||n.nodeType===8)return;a=o(a);var c=E.data(n,"events");c||(c=E.data(n,"events",{})),l=c.handle,l||(l=c.handle=function(e){return h.call(l.el,e)}),f=c[a],f||(f=c[a]=[],r(n,a,l)),s?f.push({one:i}):u?f.push({handler:i,live:u}):f.push(i),l.el=n}function m(e){var t=e.el,n=e.fn,r=e.type,i=E.data(t,"events");if(!t||!i)return;var s=i[r];if(!r){for(var o in i)d(t,o);return}n?(a(s,function(e,t){if(t==n||t.one==n||t.live==n)return s.splice(e,1)}),s.length==0&&d(t,r)):d(t,r)}var n=!!e.addEventListener,r=n?function(e,t,n){e.addEventListener(t,n,!1)}:function(e,t,n){e.attachEvent("on"+t,n)},i=n?function(e,t,n){e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent("on"+t,n)},s=n?function(e,t){var t=o(t);try{var n=u.createEvent("Event");n.initEvent(t,!0,!0),e.dispatchEvent(n)}catch(r){}}:function(e,t){try{e.fireEvent("on"+t)}catch(n){}};return h.prototype={preventDefault:function(){this.isDefaultPrevented=c;var e=this.originalEvent;e.preventDefault&&e.preventDefault(),e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=c;var e=this.originalEvent;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=c,this.stopPropagation()},isDefaultPrevented:l,isPropagationStopped:l,isImmediatePropagationStopped:l},{add:v,remove:m,dispatch:s}}();E.extend({ajax:x,event:T}),E.each("click,dblclick,mouseover,mouseout,mouseenter,mouseleave,mousedown,mouseup,keydown,keyup,keypress,focus,blur".split(","),function(e,t){E.fn[e]=function(t,n){return arguments.length==0?this.fire(e):this.on(e,t,n),this}}),typeof define=="function"&&define.amd&&define.amd?define("zchain",[],function(){return E}):e.zChain=e.$=E})(this)
/**
 *
 * ZChain JS
 * Version:  0.1
 * weibo: @snandy
 * Blog: http://snandy.cnblogs.com
 * Date: 2011-09-19
 * 
 * 1, 重写了选择器，已支持id，className, tagName, attribute
 * 2, 重写了事件模块
 * 3, 去掉了isUndefined，isNull，isBoolean，isString，isNumber等
 * 4, 事件模块重写  （die/undelegate）
 * 5, 增加domReady（$.ready 或  $(function(){})）
 * 6, 增加data/removeData，事件模块重写利用data函数
 * 7, 增加特性判断模块（support对象）
 * 8, class属性操作重写（标准浏览器使用classList属性）
 *
 */(function(a,b){function p(a,b){return new p.prototype.init(a,b)}var c=Object.prototype,d=String.prototype,e=Array.prototype,f=e.slice,g=e.push,h=a.document,i=h.compatMode=="CSS1Compat",j=/\s/,k=/^\s+/,l=/\s+$/;j.test(" ")||(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/);var m=function(a){return f.call(a,0)};try{f.call(document.documentElement.childNodes,0)[0].nodeType}catch(n){m=function(a){var b=[];for(var c=0,d=a.length;c<d;c++)b[c]=a[c];return b}}var o=function(){var a,b,c;a=document.createElement("div"),a.className="a",a.innerHTML='<p style="color:red;"><a href="#" style="opacity:.45;float:left;">a</a></p>',a.setAttribute("class","t"),b=a.getElementsByTagName("p")[0],c=b.getElementsByTagName("a")[0];var d,d,e,f;return d=a.className==="t",cssText=/;/.test(b.style.cssText),e=/^0.45$/.test(c.style.opacity),f=!!document.defaultView&&!!document.defaultView.getComputedStyle,{setAttr:d,cssText:cssText,opacity:e,classList:!!a.classList,cssFloat:!!c.style.cssFloat,getComputedStyle:f}}();p.prototype={init:function(c,d){function q(a,b,c){function e(a){var e=b=="className"?a.className:a.getAttribute(b);if(e){if(!c)return!0;if(d.test(e))return!0}return!1}var d=RegExp("(?:^|\\s+)"+c+"(?:\\s+|$)"),f=-1,g,h=-1,i=[];while(g=a[++f])e(g)&&(i[++h]=g);return i}var e=/^#[-\w]+/,f=/^([-\w]+)?\.([-\w]+)/,g=/^([\w\*]+)$/,i=/^([-\w]+)?\[([\w]+)(=(\w+))?\]/,j=/^[-#\w]+$/.test(c);d=d===b?h:typeof d=="string"?h.getElementById(d.substr(1,d.length)):d;if(c==null)return;if(typeof c=="function"){p.ready(c);return}if(c.nodeType||c==a){this[0]=c,this.length=1;return}if(e.test(c)){this[0]=h.getElementById(c.substr(1,c.length)),this[0]&&(this.length=1);return}if(!j&&d.querySelectorAll){if(d.nodeType==1){var k=d.id,l=d.id="__zchain__";try{return this._toSelf(d.querySelectorAll("#"+l+" "+c))}catch(m){}finally{k?d.id=k:d.removeAttribute("id")}}this._toSelf(d.querySelectorAll(c));return}if(f.test(c)){var n=c.split("."),o=d.getElementsByTagName(n[0]||"*");this._toSelf(q(o,"className",n[1]));return}if(g.test(c)){this._toSelf(d.getElementsByTagName(c));return}if(i.test(c)){var n=i.exec(c),o=d.getElementsByTagName(n[1]||"*");this._toSelf(q(o,n[2],n[4]));return}},length:0,_toSelf:function(a){g.apply(this,m(a))},find:function(a,c){var d=c===b?this[0]:this[c];return new p.prototype.init(a,d)},toArray:function(){return m(this)},slice:function(){var a=p(),b=f.apply(this,arguments);return g.apply(a,b),a},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},get:function(a){return a==null?this.toArray():a<0?this.slice(a)[0]:this[a]},each:function(a){return p.each(this,a),this},attr:function(a,c){if(c!==b)return this.each(function(b){switch(a){case"class":b.className=c;break;case"style":b.style.cssText=c;break;default:b.setAttribute(a,c)}}),this;var d=this[0];switch(a){case"class":return d.className;case"style":return d.style.cssText;default:return d.getAttribute(a)}},prop:function(a,c){return c===b?this[0][a]:(this.each(function(b){b[a]=c}),this)},css:function(c,d){function l(a){return a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}if(d===b){var e=this[0],f;if(c=="opacity"){var g,i,j=/opacity=/i;return p.ie?(f=e.currentStyle,i=f.filter,j.test(i)?parseFloat(i.match(/opacity=([^)]*)/i)[1])/100:1):(f=a.getComputedStyle(e,null),g=f.opacity,g.length>1&&(g=g.substr(0,3)),parseFloat(g))}if(a.getComputedStyle)return a.getComputedStyle(e,null).getPropertyValue(l(c));if(h.defaultView&&h.defaultView.getComputedStyle){var k=h.defaultView.getComputedStyle(e,null);if(k)return k.getPropertyValue(l(c))}return e.currentStyle?e.currentStyle[c]:e.style[c]}return this.each(function(a){c=="opacity"?p.ie?(a.style.filter="alpha(opacity="+d*100+");",a.style.zoom=1):a.style.opacity=d==1?"":""+d:(typeof d=="number"&&(d+="px"),a.style[c]=d)}),this},isStyle:function(a,b){return this.css(a)==b},text:function(a){return this.prop(this[0].innerText===b?"innerText":"textContent",a)},html:function(a){return this.prop("innerHTML",a)},val:function(a){if(a===b){var c=this[0];return c.tagName=="INPUT"&&/checkbox|radio/.test(c.type)?c.checked:c.value}return this.prop("value",a)},hasClass:function(a){return q.has(this[0],a)},addClass:function(a){return this.each(function(b){q.add(b,a)})},removeClass:function(a){return this.each(function(b){q.remove(b,a)})},toggleClass:function(a){return this.each(function(b){q.toggle(b,a)})},replaceClass:function(a,b){return this.each(function(c){q.replace(c,a,b)})},on:function(a,b,c,d){return this.each(function(e){p.event.add({el:e,type:a,fn:b,once:c,live:d})})},un:function(a,b){return this.each(function(c){p.event.remove({el:c,type:a,fn:b})})},fire:function(a){this.each(function(b){p.event.dispatch(b,a)})},delegate:function(a,b,c){return arguments.length===2&&p.isFunction(b)&&(c=b,b="click"),this.each(function(d){p(d).on(b,function(b){var d=b.target;p(a,this).each(function(a){(d==a||$.contains(a,d))&&c.call(a,b)})},null,c)})},undelegate:function(a,b,c){return this.each(function(a){p(a).un(b,c)})},hover:function(a,b){this.each(function(c){p(c).mouseenter(a).mouseleave(b)})}},p.fn=p.prototype.init.prototype=p.prototype,p.extend=p.fn.extend=function(a){for(var b in a)this[b]=a[b]};var q=function(){function g(a,b){return a.nodeType!==1||typeof b!="string"?!1:!0}var a=o.classList,b,c,d,e,f;return a?(b=function(a,b){return g(a,b)?a.classList.contains(b):!1},c=function(a,b){var c=0,d;if(g(a,b)){b=b.split(" ");while(d=b[c++])a.classList.add(d)}},d=function(a,b){var c=0,d;if(g(a,b)){b=b.split(" ");while(d=b[c++])a.classList.remove(d)}},e=function(a,b){g(a,b)&&a.classList.toggle(b)}):(b=function(a,b){return g(a,b)?(" "+a.className+" ").indexOf(" "+b+" ")!=-1:!1},c=function(a,c){g(a,c)&&!b(a,c)&&(a.className+=(a.className?" ":"")+c)},d=function(a,b){g(a,b)&&(a.className=a.className.replace(RegExp("\\b"+b+"\\b","g"),""))},e=function(a,e){b(a,e)?d(a,e):c(a,e)}),f=function(a,b,e){d(a,b),c(a,e)},{has:b,add:c,remove:d,toggle:e,replace:f}}();p.extend({uuid:0,cache:{},expando:"zChain"+(""+Math.random()).replace(/\D/g,""),data:function(a,c,d){var e=p.expando,f=typeof c=="string",g,h=a.nodeType,i=h?p.cache:a,j=h?a[e]:a[e]&&e;return!j&&h&&(a[e]=j=++p.uuid),i[j]||(i[j]={}),g=i[j],d!==b&&(g[c]=d),f?g[c]:g},removeData:function(a,b){var c=p.expando,d=a[c],e=p.cache[d];if(!d||!e)return;typeof b=="string"?delete e[b]:delete p.cache[d]}}),p.fn.extend({data:function(a,c){if(a===b)return p.data(this[0]);if(c===b)return p.data(this[0],a);this.each(function(){p.data(this,a,c)})},removeData:function(a){return this.each(function(){p.removeData(this,a)})}}),p.extend({isFunction:function(a){return typeof a=="function"},isPlainObject:function(b){return!b||b===a||b===h||b===h.body?!1:"isPrototypeOf"in b&&c.toString.call(b)==="[object Object]"},isEmptyObject:function(a){for(var b in a)return!1;return!0},isPrimitive:function(a){var c=typeof a;return a===b||a===null||c=="boolean"||c=="number"||c=="string"},ready:function(b){function j(a){g(a),c?a():e.push(a)}function g(){if(d)return;d=1,h.readyState==="complete"?i():h.addEventListener?(h.addEventListener("DOMContentLoaded",function(){h.removeEventListener("DOMContentLoaded",arguments.callee,!1),i()},!1),a.addEventListener("onload",i,!1)):h.attachEvent&&(h.attachEvent("onreadystatechange",function(){h.readyState==="complete"&&(h.detachEvent("onreadystatechange",arguments.callee),i())}),a.attachEvent("onload",i),f.doScroll&&a==a.top&&k())}function i(){c=1;if(!h.body){setTimeout(i,10);return}for(var a=0,b=e.length;a<b;a++)e[a]();e=[]}function k(){if(c)return;try{f.doScroll("left")}catch(a){setTimeout(k,10);return}i()}var c=0,d=0,e=[],f=h.createElement("p"),g,i;return j}()}),p.extend(function(a){var b={msie:/msie/.test(a)&&!/opera/.test(a),opera:/opera/.test(a),safari:/webkit/.test(a)&&!/chrome/.test(a),firefox:/firefox/.test(a),chrome:/chrome/.test(a),maxthon:/maxthon/.test(a),sogou:/se/.test(a),tt:/TencentTraveler/.test(a)},c="",d;for(var e in b)if(b[e]){c="safari"==e?"version":e;break}return b.version=c&&RegExp("(?:"+c+")[\\/: ]([\\d.]+)").test(a)?RegExp.$1:"0",b.ie=b.msie,d=parseInt(b.version,10),b.ie6=b.msie&&d==6,b.ie7=b.msie&&d==7,b.ie8=b.msie&&d==8,b.ie9=b.msie&&d==9,b}(navigator.userAgent.toLowerCase())),p.extend({each:function(a,b){var c,d=0,e=a.length;if("length"in a)for(var f=a[0];d<e&&b.call(f,f,d)!==!1;f=a[++d]);else for(c in a)if(b.call(a[c],a[c],c)===!1)break},makeArray:m,applyIf:function(a,c){var d=f.call(arguments,1),e=-1,g;if(d.length)while(c=d[++e])for(g in c)a[g]===b&&(a[g]=c[g]);return a},contains:function(a,b){try{return a.contains?a!=b&&a.contains(b):!!(a.compareDocumentPosition(b)&16)}catch(c){}}}),p.applyIf(d,{trim:function(){return this.replace(k,"").replace(l,"")}}),Array.isArray||(Array.isArray=function(a){return c.toString.call(a)==="[object Array]"}),p.applyIf(e,{indexOf:function(a,b){var c=b==null?0:b<0?Math.max(0,arr.length+b):b;for(var d=c,e=this.length;d<e;d++)if(d in this&&this[d]===a)return d;return-1},lastIndexOf:function(a,b){var c=this.length,d=b==null?c-1:b;d<0&&(d=Math.max(0,c+d));for(var e=d;e>=0;e--)if(e in this&&this[e]===a)return e;return-1},every:function(a,b){var c=this.length;for(var d=0;d<c;d++)if(d in this&&!a.call(b,this[d],d,this))return!1;return!0},some:function(a,b){var c=this.length;for(var d=0;d<c;d++)if(d in this&&a.call(b,this[d],d,this))return!0;return!1},filter:function(a,b){var c=this.length,d=[],e=0;for(var f=0;f<c;f++)if(f in this){var g=this[f];a.call(b,g,f,this)&&(d[e++]=g)}return d},map:function(a,b){var c=this.length,d=[];for(var e=0;e<c;e++)e in this&&(d[e]=a.call(b,this[e],e,this));return d},forEach:function(a,b){var c=this.length;for(var d=0;d<c;d++)d in this&&a.call(b,this[d],d,this)}}),p.extend({array:{contain:function(a,b){return a.indexOf(b)!=-1},removeAt:function(a,b){return e.splice.call(a,b,1).length==1},remove:function(a,b){var c=a.indexOf(b),d;return(d=c>=0)&&this.removeAt(a,c),d}},string:{encodeUriRegExp_:/^[a-zA-Z0-9\-_.!~*'()]*$/,startsWith:function(a,b){return a.lastIndexOf(b,0)==0},endsWith:function(a,b){var c=a.length-b.length;return c>=0&&a.indexOf(b,c)==c},isEmpty:function(a){return/^[\s\xa0]*$/.test(a)},isNumeric:function(a){return!/[^0-9]/.test(a)},toNumber:function(a){var b=Number(a);return b==0&&this.isEmpty(a)?NaN:b},trimLeft:function(a){return a.replace(k,"")},trimRight:function(a){return a.replace(l,"")},left:function(a,b){var c=a.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");return c=c.slice(0,b).replace(/\*\*/g," ").replace(/\*/g,"").length,a.slice(0,c)},right:function(a,b){var c=a.length,d=a.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");return d=d.slice(d.length-b,d.length).replace(/\*\*/g," ").replace(/\*/g,"").length,a.slice(c-d,c)},urlEncode:function(a){return a=String(a),this.encodeUriRegExp_.test(a)?a:encodeURIComponent(a)},urlDecode:function(a){return decodeURIComponent(a.replace(/\+/g," "))}},cookie:function(a,b){if(arguments.length!=2){var d=a+"=",e=h.cookie,f=e.length;if(e.indexOf(d)!=-1){var g=e.indexOf(d)+d.length;return e.indexOf(";",g)==-1?f=e.length:f=e.indexOf(";",g),e.substring(g,f)}return""}var c=new Date(2099,12,31);h.cookie=a+"="+b+";expires="+c.toGMTString()+";"}});var r=function(){function c(a,b){function c(){}b=b||{};var f=b.async!==!1,g=b.method||"GET",h=b.type||"text",i=b.encode||"UTF-8",j=b.timeout||0,k=b.data||null,l=b.success||c,m=b.failure||c;g=g.toUpperCase(),k&&typeof k=="object"&&(k=d(k)),g=="GET"&&k&&(a+=(a.indexOf("?")==-1?"?":"&")+k,k=null);var n=function(){try{return new XMLHttpRequest}catch(a){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){m(null,"create xhr failed",a)}}}}();if(!n)return;var o=!1,p;return f&&j>0&&(p=setTimeout(function(){o=!0,n.abort()},j)),n.onreadystatechange=function(){n.readyState==4&&(o?m(n,"request timeout"):(e(n,h,l,m),clearTimeout(p)))},n.open(g,a,f),g=="POST"&&n.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset="+i),n.send(k),n}function d(a){var b=[];for(var c in a){var d=a[c];if(d.constructor==Array)for(var e=0,f=d.length;e<f;e++)b.push(c+"="+encodeURIComponent(d[e]));else b.push(c+"="+encodeURIComponent(d))}return b.join("&")}function e(c,d,e,f){var g=c.status,h;if(g>=200&&g<300){switch(d){case"text":h=c.responseText;break;case"json":h=function(b){try{return a.JSON.parse(b)}catch(d){try{return(new Function("return "+b))()}catch(d){f(c,"parse json error",d)}}}(c.responseText);break;case"xml":h=c.responseXML}h!==b&&e(h)}else f(c,c.status);c=null}return function(){var a={request:c},b=["text","json","xml"];return p.each(b,function(b,d){a[b]=function(a,d){return d=d||{},d.type=b,c(a,d)}}),a}()}(),s=function(){function g(a){var a=a;return p.ie||(a=a=="mouseenter"?"mouseover":a=="mouseleave"?"mouseout":a),a}function i(a,b){for(var c=0;c<a.length;)b(c,a[c])?c=0:c++}function j(){return(new Date).getTime()}function k(){return!1}function l(){return!0}function m(a){this.originalEvent=a,this.type=a.type,this.timeStamp=j()}function n(a){var c="altKey bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedTarget screenX screenY shiftKey target toElement view wheelDelta which".split(" "),d=c.length,e=a;a=new m(e);for(var f=d,g;f;)g=c[--f],a[g]=e[g];a.target||(a.target=a.srcElement||document),a.target.nodeType===3&&(a.target=a.target.parentNode),!a.relatedTarget&&a.fromElement&&(a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement);if(a.pageX==null&&a.clientX!=null){var h=document.documentElement,i=document.body;a.pageX=a.clientX+(h&&h.scrollLeft||i&&i.scrollLeft||0)-(h&&h.clientLeft||i&&i.clientLeft||0),a.pageY=a.clientY+(h&&h.scrollTop||i&&i.scrollTop||0)-(h&&h.clientTop||i&&i.clientTop||0)}return!a.which&&(a.charCode||a.charCode===0?a.charCode:a.keyCode)&&(a.which=a.charCode||a.keyCode),!a.metaKey&&a.ctrlKey&&(a.metaKey=a.ctrlKey),!a.which&&a.button!==b&&(a.which=a.button&1?1:a.button&2?3:a.button&4?2:0),a}function o(a,b){var b=g(b),c=p.data(a,"events");e(a,b,c[b].handle),delete c[b],p.isEmptyObject(c)&&p.removeData(a,"events")}function q(b){function m(b){var d=n(b||a.event),e=p.data(this,"events")[d.type];for(var f=0,g;g=e[f++];)typeof g=="function"?!!p.ie||i!="mouseenter"&&i!="mouseleave"?g.call(c,d):o(d):g.one?(g.one.call(c,d),r({el:c,type:i,fn:g.one}),f--):g.live&&g.handler.call(c,d)}function o(a){!p.contains(a.currentTarget,a.relatedTarget)&&a.currentTarget!=a.relatedTarget&&e.call(a.currentTarget,a)}var c=b.el,e=b.fn,f=b.once,h=b.live,i=b.type||"click",j,k;if(c==a||c.nodeType===3||c.nodeType===8)return;i=g(i);var l=p.data(c,"events");l||(l=p.data(c,"events",{})),k=l.handle,k||(k=l.handle=function(a){return m.call(k.el,a)}),j=l[i],j||(j=l[i]=[],d(c,i,k)),f?j.push({one:e}):h?j.push({handler:e,live:h}):j.push(e),k.el=c}function r(a){var b=a.el,c=a.fn,d=a.type,e=p.data(b,"events");if(!b||!e)return;var f=e[d];if(!d){for(var g in e)o(b,g);return}c?(i(f,function(a,b){if(b==c||b.one==c||b.live==c)return f.splice(a,1)}),f.length==0&&o(b,d)):o(b,d)}var c=!!a.addEventListener,d=c?function(a,b,c){a.addEventListener(b,c,!1)}:function(a,b,c){a.attachEvent("on"+b,c)},e=c?function(a,b,c){a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent("on"+b,c)},f=c?function(a,b){var b=g(b);try{var c=h.createEvent("Event");c.initEvent(b,!0,!0),a.dispatchEvent(c)}catch(d){alert(d)}}:function(a,b){try{a.fireEvent("on"+b)}catch(c){alert(c)}};return m.prototype={preventDefault:function(){this.isDefaultPrevented=l;var a=this.originalEvent;a.preventDefault&&a.preventDefault(),a.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=l;var a=this.originalEvent;a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=l,this.stopPropagation()},isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k},{add:q,remove:r,dispatch:f}}();p.extend({ajax:r,event:s}),p.each("click,dblclick,mouseover,mouseout,mouseenter,mouseleave,mousedown,mouseup,keydown,keyup,keypress,focus,blur".split(","),function(a,b){p.fn[a]=function(b,c){return arguments.length==0?this.fire(a):this.on(a,b,c),this}}),a.zChain=a.$=p,typeof define=="function"&&define.amd&&define.amd.zChain&&define("zchain",[],function(){return p})})(this);